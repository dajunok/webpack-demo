一、简介：
    这个插件使用terser压缩JavaScript代码。 
    用terser-webpack-plugin插件替换掉uglifyjs-webpack-plugin解决uglifyjs不支持es6语法问题

二、安装：
    $ npm install terser-webpack-plugin --save-dev
三、配置：（官网：https://www.npmjs.com/package/terser-webpack-plugin#terser-webpack-plugin）
    1、插件选项列表如下：
        =================================================================================================================================
            选项                           类型（Type）：                                        含义                   默认值（Default）
        ---------------------------------------------------------------------------------------------------------------------------------*
            test                String|RegExp|Array<String|RegExp>                      匹配要压缩的文件                /\.m?js(\?.*)?$/i
        ---------------------------------------------------------------------------------------------------------------------------------*
            include             String|RegExp|Array<String|RegExp>                      包含要压缩的文件目录          
        ---------------------------------------------------------------------------------------------------------------------------------*
            exclude             String|RegExp|Array<String|RegExp>                      排除要压缩的文件目录        
        ---------------------------------------------------------------------------------------------------------------------------------*
            chunkFilter         Function<(chunk) -> boolean>                            过滤要压缩的chunk块            () => true
        ---------------------------------------------------------------------------------------------------------------------------------*
            cache               Boolean|String                                          启用/禁用文件缓存               true   
        ---------------------------------------------------------------------------------------------------------------------------------*
            parallel            Boolean|Number                                          启用/禁用多进程                 true
        ---------------------------------------------------------------------------------------------------------------------------------*
            sourceMap           Boolean                                                 源代码映射                      false
        ---------------------------------------------------------------------------------------------------------------------------------*
            minify              Function                               允许指定压缩函数覆盖默认的压缩功能。默认情况下使用terser插件包。      
        ---------------------------------------------------------------------------------------------------------------------------------*
            terserOptions       Object                                 设置Terser压缩选项（它是一个对象，具体设置参见下面的Terser压缩选项列表）
        ---------------------------------------------------------------------------------------------------------------------------------*
            extractComments     Boolean|String|RegExp|
                                Function<(node, comment) -> Boolean|Object>|Object      是否应将注释提取到单独的文件中     true

                                Boolean     启用/禁用提取注释。
                                String      提取所有或一些（使用/^\**!|@preserve|@license|@cc_on/i正则匹配）注释。
                                RegExp      所有匹配正则表达式的注释将被提取到单独的文件中。
                                Function<(node, comment) -> Boolean     所有匹配正则表达式的注释将被提取到单独的文件中。
                                Object      允许自定义条件提取注释，指定提取文件名和banner。

        =================================================================================================================================*
    

    2、 terserOptions选项配置（Terser压缩工具选项）：
        =================================================================================================================================
            选项                                                  简介
        ---------------------------------------------------------------------------------------------------------------------------------*
            ecma                    ECMAScript版本，可以设置为：5、2015、2016、2017或者2018之中的任何一个。
                                    它会覆盖parse、compress和output选项指定的ecma。
        ---------------------------------------------------------------------------------------------------------------------------------*
            warnings                （默认为false），当指定为true时，在result.warnings中返回压缩器警告；指定为"verbose"时，显示更详细的警告信息。
        ---------------------------------------------------------------------------------------------------------------------------------*
            parse                   （默认为空对象{})，用于指定解析器的具体选项（参见Parse options）
        ---------------------------------------------------------------------------------------------------------------------------------*
            compress                （ 默认为空对象{} ），用于指定具体压缩选项（参见Compress options）。指定为false时则不会进行压缩；
                                    传递一个自定义压缩选项对象设置要压缩的项（具体设置参见下面的compress压缩选项列表）。
        ---------------------------------------------------------------------------------------------------------------------------------*
            mangle                  混淆代码（默认为true），指定为false则跳过mangling名称。（例如混淆参数名称）。
        ---------------------------------------------------------------------------------------------------------------------------------*
            module                 （默认为false）， 在压缩ES6模块时使用。“use strict”是隐含的，名称可以在顶部作用域中被mangle。
                                    如果启用compress 或者 mangle，则启用toplevel选项。
        ---------------------------------------------------------------------------------------------------------------------------------*
            output                  （默认为false），如果要指定其他输出选项，请传递一个对象。默认情况下经过优化以实现最佳压缩。
        ---------------------------------------------------------------------------------------------------------------------------------*
            sourceMap               是否为压缩后的代码生成对应的Source Map（默认为false），如果要指定源代码映射选项，请传递对象。
        ---------------------------------------------------------------------------------------------------------------------------------*
            toplevel                是否启用顶级变量（默认为false），如果指定为true，启用顶级变量和函数名管理并删除未使用的变量和函数
        ---------------------------------------------------------------------------------------------------------------------------------*
            nameCache               是否使用名称缓存（默认为null），如果希望在多次调用minify()时缓存mangle的变量和属性名称，请传递空对象{}或以前使用的
                                        nameCache对象。注意：这是一个读/写属性。minify()将读取此对象的名称缓存状态，
                                        并在压缩过程中对其进行更新，以便用户可以重用或外部保存它。
        ---------------------------------------------------------------------------------------------------------------------------------*
            ie8                      是否支持IE8（默认为false），当设置为true时支持IE8。
        ---------------------------------------------------------------------------------------------------------------------------------*
            keep_classnames          是否保持原有类名（默认为undefined），指定为true防止类名被discarding（放弃原有类名）或者mangling（极限压缩）。指定为正则表达式以仅保持类名与该正则表达式匹配。
        ---------------------------------------------------------------------------------------------------------------------------------*
            keep_fnames              是否保持原有函数名（默认为false），指定为true以防止函数名被discarding（丢弃原有函数名）或者mangling（极限压缩）。
                                      传递正则表达式以仅保持类名与该正则表达式匹配。对于依赖Function.prototype.name的代码很有用。
                                      如果顶级minify选项keep_classnames未定义，则它将被顶级minify选项keep_fnames的值覆盖。
        ---------------------------------------------------------------------------------------------------------------------------------*
            safari10                 （默认为false），通过指定true来处理Safari 10/11循环中的bug范围并等待。有关详细信息，
                                      请参阅mangle和output中的safari10选项。  
        =================================================================================================================================*
    
    3、compress压缩选项配置：
        =================================================================================================================================
            选项                                                  简介
        ---------------------------------------------------------------------------------------------------------------------------------*
            arrows                 （默认为true），如果希望生成较短的代码，则类和对象文本方法可以转换为箭头表达式：m(){return x} becomes m:()=>x。
                                    要对常规ES5函数执行这种操作操作，请参见下面的unsafe_arrows选项。
        ---------------------------------------------------------------------------------------------------------------------------------*
            arguments               （默认为false），尽可能用函数参数名替换arguments[index]。
        ---------------------------------------------------------------------------------------------------------------------------------*
            booleans                （默认为true），Boolean值的各种优化，例如：!!a ? b : c → a ? b : c
        ---------------------------------------------------------------------------------------------------------------------------------*
            booleans_as_integers    （默认为false），将布尔值转换为0和1，并使用== 和 != 与布尔值进行比较，而不是采用 === 和 !==
        ---------------------------------------------------------------------------------------------------------------------------------*
            collapse_vars           （默认为true），合并一次性非常量变量。是否内嵌虽然已经定义了，但是只用到一次的变量，比如将 var x = 1; y = x, 
                                     转换成 y = 5, 默认为不转换，为了达到更好的压缩效果，可以设置为false
        ---------------------------------------------------------------------------------------------------------------------------------*
            comparisons              （默认为true），把结果必然的运算优化成二元运算，例如!(a <= b) → a > b (只有设置了 unsafe_comps时才生效)；
                                      尽量转成否运算。例如 a = !b && !c && !d && !e → a=!(b||c||d||e)          
        ---------------------------------------------------------------------------------------------------------------------------------*
            computed_props           （默认为true），将常规计算属性转换为常量：{["computed"]: 1}被转换为 {computed: 1}
        ---------------------------------------------------------------------------------------------------------------------------------*
            conditionals             （默认为true），优化if等判断以及条件选择
        ---------------------------------------------------------------------------------------------------------------------------------*
            dead_code                （默认为true），移除没被引用的代码
        ---------------------------------------------------------------------------------------------------------------------------------*
            defaults                 （默认为true），传false以禁用大多数默认启用的压缩转换。当您只想在禁用其他选项的同时启用一些压缩选项时非常有用。
        ---------------------------------------------------------------------------------------------------------------------------------*
            directives               （默认为true），清除多余或非标准命令
        ---------------------------------------------------------------------------------------------------------------------------------*
            drop_console             （默认为false），是否删除代码中所有的console语句，默认为不删除，开启后，会删除所有的console语句
        ---------------------------------------------------------------------------------------------------------------------------------*
            drop_debugger            （默认为true），移除 debugger。  
        ---------------------------------------------------------------------------------------------------------------------------------*
            ecma                     （默认为5），指定为2015或更高版本启用压缩选项。这将把ES5代码转换成更小的ES6+等价形式。
        ---------------------------------------------------------------------------------------------------------------------------------*
            evaluate                 （默认为true），尝试计算常量表达式
        ---------------------------------------------------------------------------------------------------------------------------------*
            expression               （默认为false），传true来保留终端语句中没有"return"的完成值。例如在bookmarklets。
        ---------------------------------------------------------------------------------------------------------------------------------*
            global_defs              （默认为 {} ），参见条件编译（conditional compilation）   
        ---------------------------------------------------------------------------------------------------------------------------------*
            hoist_funs               （默认为false）， 提升函数声明
        ---------------------------------------------------------------------------------------------------------------------------------*
            hoist_props              （默认为true），将属性从常量对象和数组文字提升为受一组约束的正则变量。
                                      例如：var o={p:1, q:2}; f(o.p, o.q)；被转换为f(1, 2)；。注意：在启用mangle、compress选项设置为2或更高、
                                      compress选项toplever启用的情况下，hoist_props的工作效率最佳。 
        ---------------------------------------------------------------------------------------------------------------------------------*
            hoist_vars               （默认为false）， 提升 var 声明 (默认是false,因为那会加大文件的size)
        ---------------------------------------------------------------------------------------------------------------------------------*
            if_return                （默认为true），优化 if/return 和 if/continue 
        ---------------------------------------------------------------------------------------------------------------------------------*
            inline                   （默认为true），包裹简单函数。将简单的return函数设为内联调用函数。可以传递下面的值：
                                        false -- 与传0相同
                                        0     -- 禁用内联
                                        1     -- 内联简单函数
                                        2     -- 带参数的内联函数
                                        3     -- 带参数和变量的内联函数
                                        true  -- 与传3相同
        ---------------------------------------------------------------------------------------------------------------------------------*
            join_vars                （默认为true），合并连续 var 声明语句
        ---------------------------------------------------------------------------------------------------------------------------------*
            keep_classnames          （默认为false），传true以防止压缩器丢弃类名。传递正则表达式以仅保持类名与该正则表达式匹配。
                                      另请参见：mangle中的keep_classnames 选项。
        ---------------------------------------------------------------------------------------------------------------------------------*
            keep_fargs               （默认为true），阻止压缩器干掉那些没有用到的函数参数。你需要它来保护某些依赖Function.length的函数。
        ---------------------------------------------------------------------------------------------------------------------------------*
            keep_fnames              （默认为false），传 true来防止压缩器干掉函数名。对那些依赖Function.prototype.name的函数很有用。
                                      延展阅读：keep_fnames 混淆选项.
        ---------------------------------------------------------------------------------------------------------------------------------*
            keep_infinity            （默认为false），传true以防止压缩时把1/0转成Infinity，那可能会在chrome上有性能问题。
        ---------------------------------------------------------------------------------------------------------------------------------*
            loops                    （默认为true），当do、while 、 for循环的判断条件可以确定是，对其进行优化。
        ---------------------------------------------------------------------------------------------------------------------------------*
            module                   （默认为false），传true压缩为ES6模块。严格模式是隐含的，包括toplevel选项。
        ---------------------------------------------------------------------------------------------------------------------------------*
            negate_iife              （默认为true），当立即执行函数（IIFE）的返回值没用时，取消之。避免代码生成器会插入括号。
        ---------------------------------------------------------------------------------------------------------------------------------*
            passes                   （默认为1），运行压缩的次数。在某些情况下，用一个大于1的数字参数可以进一步压缩代码大小。
                                      注意：数字越大压缩耗时越长。 
        ---------------------------------------------------------------------------------------------------------------------------------*
            properties               （默认为true），用.来重写属性引用，例如foo["bar"] → foo.bar   
        ---------------------------------------------------------------------------------------------------------------------------------*
            pure_funcs               （默认为null），你可以传入一个名字的数组，terser会假设这些函数没有函数副作用。**警告：**假如名字在作用域中
                                      重新定义，不会再次检测。例如var q = Math.floor(a/b)，假如变量q没有被引用，UglifyJS会干掉它，
                                      但 Math.floor(a/b)会被保留，没有人知道它是干嘛的。你可以设置pure_funcs: [ 'Math.floor' ] ，
                                      这样该函数会被认为没有函数副作用，这样整个声明会被废弃。在目前的执行情况下，会增加开销（压缩会变慢）。     
        ---------------------------------------------------------------------------------------------------------------------------------*
            pure_getters             （默认为"strict"），如果你传入true，terser会假设对象属性的引用（例如foo.bar 或 foo["bar"]）没有函数副作用。  
        ---------------------------------------------------------------------------------------------------------------------------------*
            reduce_funcs              （传统选项，为向后兼容而安全忽略）。
        ---------------------------------------------------------------------------------------------------------------------------------*
            reduce_vars               改进变量赋值和用作常量的优化（默认为true）， 是否提取出现了多次但是没有定义成变量去引用的静态值，比如将 x = 'xxx'; y = 'xxx'  转换成
                                      var a = 'xxxx'; x = a; y = a; 默认为不转换，为了达到更好的压缩效果，可以设置为false 
        ---------------------------------------------------------------------------------------------------------------------------------*
            sequences                （默认为true），连续声明变量，用逗号隔开来。可以设置为正整数来指定连续声明的最大长度。如果设为true 
                                      表示默认200个，设为false或0则禁用。 sequences至少要是2,1的话等同于true（即200)。
                                      默认的sequences设置有极小几率会导致压缩很慢，所以推荐设置成20或以下。  
        ---------------------------------------------------------------------------------------------------------------------------------*
            side_effects             （默认为true）， 传false禁用丢弃纯函数。如果一个函数被调用前有一段
                                      /*@__PURE__*/ or /*#__PURE__*/注释，该函数会被标注为纯函数。例如 /*@__PURE__*/foo(); 
        ---------------------------------------------------------------------------------------------------------------------------------*
            switches                 （默认为true）， 消除重复并删除无法访问的交换分支 。
        ---------------------------------------------------------------------------------------------------------------------------------*
            toplevel                 （默认为false），干掉顶层作用域中没有被引用的函数 ("funcs")和/或变量("vars") 。(true 的话即函数变量都干掉)  
        ---------------------------------------------------------------------------------------------------------------------------------*
            top_retain               （默认为null），防止删除未被使用的特定的顶级函数和变量（可以是数组、逗号分隔、RegExp或函数）。隐含toplevel） 。
        ---------------------------------------------------------------------------------------------------------------------------------*
            typeofs                  （默认为true），转换 typeof foo == "undefined" 成 foo === void 0. 注意：如果要适配IE10或以下，
                                      由于已知的问题，推荐设成false 。  
        ---------------------------------------------------------------------------------------------------------------------------------*
            unsafe                   （默认为false），使用 "unsafe"转换
        ---------------------------------------------------------------------------------------------------------------------------------*
            unsafe_arrows            （默认为false），如果函数体不引用ES5样式的匿名函数表达式，则将其转换为箭头函数。
                                      注意：如果代码依赖于具有原型的函数（箭头函数缺少原型），则执行此转换并不总是安全的。
                                      此转换要求将ecma和 compress选项设置为2015或更高版本。
        ---------------------------------------------------------------------------------------------------------------------------------*
            unsafe_comps             （默认为false），保留< 和 <=不被换成 > 和 >=。假如某些运算对象是用get或 valueOfobject得出的时候，
                                      转换可能会不安全，可能会引起运算对象的改变。此选项只有当 comparisons和unsafe_comps 都设为true时才会启用。
        ---------------------------------------------------------------------------------------------------------------------------------*
            unsafe_Function          （默认为false），当 Function(args, code)的args 和 code都是字符串时，压缩并混淆。
        ---------------------------------------------------------------------------------------------------------------------------------*
            unsafe_math              （默认为false）， 优化数字表达式，例如2 * x * 3 变成 6 * x, 可能会导致不精确的浮点数结果。
        ---------------------------------------------------------------------------------------------------------------------------------*
            unsafe_methods           （默认为false），将 { m: function(){} }转换为 { m(){} }。ecma必须设置为6或更高才能启用此转换。
                                      如果unsafe_methods是正则表达式（RegExp），则键/值对（key/value）与RegExp匹配的键将转换为简明方法。
                                      注意：如果启用，任何代码尝试new一个前面的函数，则会报“<method name> 不是构造器方法 ”类型错误。
        ---------------------------------------------------------------------------------------------------------------------------------*
            unsafe_proto             （默认为false），把Array.prototype.slice.call(a) 优化成 [].slice.call(a)   
        ---------------------------------------------------------------------------------------------------------------------------------*
            unsafe_regexp            （默认为false）， 如果RegExp 的值是常量，替换成变量。  
        ---------------------------------------------------------------------------------------------------------------------------------*
            unsafe_undefined         （默认为false）， 如果在作用域中有一个名为undefined的变量，则替换void 0（混淆变量名，通常会缩减为单个字符）  
        ---------------------------------------------------------------------------------------------------------------------------------*
            unused                   （默认为true），干掉没有被引用的函数和变量。（除非设置"keep_assign"，否则变量的简单直接赋值也不算被引用。） 
        ---------------------------------------------------------------------------------------------------------------------------------*
            warnings                 （默认为false），是否在删除没有用到的代码时输出警告信息，默认为输出，可以设置为false关闭这些作用不大的警告     
       =================================================================================================================================
    

    4、Mangle选项(代码混淆选项)
        =================================================================================================================================
            选项                                                  简介
        ---------------------------------------------------------------------------------------------------------------------------------*
            eval                     （默认为false），混淆那些在with或eval中出现的名字。
        ---------------------------------------------------------------------------------------------------------------------------------*
            keep_classnames          （默认为false）， 传true时，不混淆类名。传正则表达式使得类名与该正则表达式比配。参见compress的keep_classnames选项。
        ---------------------------------------------------------------------------------------------------------------------------------*
            keep_fnames              （默认为false）， 传true的话就不混淆函数名。对那些依赖Function.prototype.name的代码有用。
                                      延展阅读：keep_fnames 压缩配置.                       
        ---------------------------------------------------------------------------------------------------------------------------------*
            module                   （默认为false），传为true，如果是ES6模块，其toplevel作用域不是全局作用域。意味着toplevel。
        ---------------------------------------------------------------------------------------------------------------------------------*
            reserved                 （默认为[ ]），不混淆在reserved 数组里的属性名.
        ---------------------------------------------------------------------------------------------------------------------------------*
            toplevel                 （默认为false），混淆那些定义在顶层作用域的名字（默认禁用）。
        ---------------------------------------------------------------------------------------------------------------------------------*
            safari10                 （默认为false），传true解决Safari 10循环迭代器错误“不能声明let变量两次”。另请参见：safari10输出选项。
        =================================================================================================================================   

    
    5、案例1：
        //webpack.config.js
        module.exports = {
          optimization: {
            minimize: true,
            minimizer: [
              new TerserPlugin({
                test: /\.js(\?.*)?$/i,  //匹配要压缩的文件
                include: path.join(__dirname, './src'),  // 包含要压缩文件的目录
                exclude: [],    //排除要压缩的文件目录
                chunkFilter: (chunk) => {   //过滤掉名为'vendor'的chunk块     
                  if (chunk.name === 'vendor') { return false; }
                  return true;
                },
                cache: true,               //启用文件缓存。缓存目录的默认路径：node_modules/.cache/terser-webpack-plugin。
                parallel: true,            //使用多进程并行运行来提高构建速度。默认并发运行数：os.cpus().length - 1。可以直接用数字指定并发运行数：parallel: 4
                sourceMap: true,           //是否生成源代码映射文件。设置源代码映射方式由devtool键指定，而不是在优化键optimization中设置。
                extractComments: false,    //是否应将注释提取到单独的文件中


              }),
            ],
          },
        };



五、术语词典
    parse       解释
    compress    压缩
    mangle      混淆
    beautify    美化
    minify      最小化
    CLI         命令行工具
    sourcemap   编译后代码对源码的映射，用于网页调试
    AST         抽象语法树
    name        名字，包括变量名、函数名、属性名
    toplevel    顶层作用域
    unreachable 不可达代码
    option      选项/配置
    STDIN       标准输入，指在命令行中直接输入
    STDOUT      标准输出
    STDERR      标准错误输出
    side effects函数副作用，即函数除了返回外还产生别的作用，比如改了全局变量
    shebang     释伴（#!）